<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="title" content="Largest Companies as Share of Market Value"/>
    <meta name="date" content="2025-08-11" />
    <meta name="tags" content="Coding, Stock Market" />
    <meta name="thumbnail" content="Articles/Images/BigCompanies.svg"/>
    <meta name="summary" content="Percent of market capitalization attributed to the largest company"/>
    <title>Luke Buck | Largest Companies as Share of Total Market Value</title>
    <link rel="stylesheet" href="Article_Template.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet" />
    <link rel="icon" href="/Images/Logo.png" type="image/png" />
</head>
<body>
  <!-- HEADER -->
  <header>
  <div class="header-container">
      <h2 class="site-name">
        <a href="../index.html">Luke Buck</a>
      </h2>
      <nav class="desktop-nav">
        <a href="../index.html#about">About</a>
        <a href="../index.html#education">Education</a>
        <a href="../index.html#articles">Projects</a>
        <a href="../index.html#experience">Experience</a>
        <a href="../index.html#music">Music</a>
        <a href="../index.html#certs">Certifications</a>
        <a href="../index.html#contact">Contact</a>
      </nav>
      <button id="menu-toggle">‚ò∞</button>
    </div>
    <nav id="mobile-menu">
      <a href="../index.html#about">About</a>
      <a href="../index.html#education">Education</a>
      <a href="../index.html#articles">Projects</a>
      <a href="../index.html#experience">Experience</a>
      <a href="../index.html#music">Music</a>
      <a href="../index.html#certs">Certifications</a>
      <a href="../index.html#contact">Contact</a>
    </nav>
  </header>

  <!-- üìù TITLE + SUMMARY -->
  <main class="article-main">
    <div class="back-wrapper">
      <a href="../projects.html" class="back-link">‚Üê Projects & Research</a>
    </div>
    <h1 class="article-title">Largest Companies as Share of Total Market Value</h1>
    <img src="Images/BigCompanies.svg" alt="Main visual" class="main-article-image" />
    <p class="article-summary">Percent of market capitalization attributed to the largest company</p>
      <p class="article-date">Published: August 11, 2025</p>
    <p class="article-date">Tags: Coding, Stock Market</p>
    <p class="article-author">By Luke Buck</p>

    <!-- üßæ ARTICLE CONTENT -->
    <article class="article-body">

      <p>It's interesting to look through the stock market's most valuable companies historically. Even more interesting is the percent of total U.S. market value attributed to the largest companies. Below is a history of the relative size of America's largest companies when compared to the entire market value (the largest company's market capitalization divided by total U.S. market value).</p>

      <div class="download-wrapper">
        <button id="downloadCSV" class="back-button">Download CSV</button>
      </div>

      <canvas id="myChart" width="600" height="400" min-height="300"></canvas>

      <p>The label at the top of the chart displays the percent of U.S. total market value and the corresponding company. IBM, General Electric, Exxon Mobil and Apple dominate the list of most valuable companies since the '70s. Notice the decrease in largest company size compared to the total market value from 1990 to 2020. Though several reasons might explain this, I think IBM's fall from its Wall Street poster-boy-status contributed to this decline. Additionally, <a href="USAMarketCap.html" target="_blank" rel="noopener">stock market value has exploded since 1990 at  unprecedented rates</a>, making it difficult for companies to hold a large percent of total U.S. market value.    
      </p>

      <p>I gathered this data from CRSP's (Center for Research in Security Prices) monthly stock file and used Python to sort the data accordingly. Hope you enjoy!</p>
    </article>
  </main>

  <footer>
  <p id="updated-footer">Last updated: <span id="updated-date"></span></p>
  <p class="signature">Tell your dog I say hi!</p>
  <p class="social-links">
    <a href="https://linkedin.com/in/luke-a-buck" target="_blank">
      <img src="../Images/linkedin.png" alt="LinkedIn" class="social-icon">
    </a>
  </p>
</footer>

</body>

<script>
  // Last updated script
  document.getElementById("updated-date").textContent =
    new Date(document.lastModified).toLocaleDateString();
</script>

<script>
    // ========== MOBILE MENU ==========
    const menuToggle = document.getElementById("menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
    menuToggle.addEventListener("click", () => {
        mobileMenu.classList.toggle("show");
    });

</script>

<script>
  window.addEventListener("scroll", () => {
    const header = document.querySelector("header");
    const maxScroll = document.body.scrollHeight - window.innerHeight;
    const scrollRatio = Math.min(1, window.scrollY / maxScroll);
    const fill = Math.floor(scrollRatio * 100);

    header.style.borderImage = `linear-gradient(to right, #3a6ea5 ${fill}%, transparent ${fill}%) 1`;
  });

      document.querySelectorAll("#mobile-menu a").forEach(link => {
      link.addEventListener("click", () => {
        document.getElementById("mobile-menu").classList.remove("show");
      });
    });

    window.addEventListener("resize", () => {
      const mobileMenu = document.getElementById("mobile-menu");
      const breakpoint = 750; // üëà change this if needed

      if (window.innerWidth > breakpoint && mobileMenu.classList.contains("show")) {
        mobileMenu.classList.remove("show");
      }
    });
</script>
<script>
    window.addEventListener("resize", () => {
      const mobileMenu = document.getElementById("mobile-menu");
      const breakpoint = 750; // üëà change this if needed

      if (window.innerWidth > breakpoint && mobileMenu.classList.contains("show")) {
        mobileMenu.classList.remove("show");
      }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

<script>
  // ‚úÖ Custom plugin to draw vertical line + ball + label
  const verticalLinePlugin = {
    id: 'verticalLine',
    afterDraw(chart) {
      const tooltip = chart.tooltip;
      if (tooltip && tooltip._active && tooltip._active.length) {
        const ctx = chart.ctx;
        const activePoint = tooltip._active[0];
        const x = activePoint.element.x;
        const y = activePoint.element.y;
        const topY = chart.chartArea.top;
        const bottomY = chart.chartArea.bottom;

        // Detect dark mode
        const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;

        // Draw vertical line
        ctx.save();
        ctx.beginPath();
        ctx.moveTo(x, topY - 10);
        ctx.lineTo(x, bottomY);
        ctx.lineWidth = 1;
        ctx.strokeStyle = '#aaa';
        ctx.stroke();
        ctx.restore();

        // Draw ball at intersection
        ctx.save();
        ctx.beginPath();
        ctx.arc(x, y, 7, 0, 2 * Math.PI);
        ctx.fillStyle = '#3a6ea5';
        ctx.fill();
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        ctx.stroke();
        ctx.restore();

        // Draw label above chart
        const value = activePoint.element.$context.raw.y;
        const date = activePoint.element.$context.raw.x;
        const company = activePoint.element.$context.raw.z;
        const formattedValue = value.toFixed(2);
        const labelText = `${new Date(date).toLocaleDateString("en-US", {
          year: "numeric",
          month: "short"
        })}: ${formattedValue}% - ${company}`;

        ctx.font = '14px "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif';
        ctx.fillStyle = isDarkMode ? '#eee' : '#333'; // ‚úÖ Light text in dark mode
        ctx.textBaseline = 'bottom';

        const textWidth = ctx.measureText(labelText).width;
        const chartLeft = chart.chartArea.left;
        const chartRight = chart.chartArea.right;

        // Determine alignment
        let textAlign = 'center';
        if (x - textWidth / 2 < chartLeft) {
          textAlign = 'left';
        } else if (x + textWidth / 2 > chartRight) {
          textAlign = 'right';
        }
        ctx.textAlign = textAlign;

        // Adjust x position if needed
        let labelX = x;
        if (textAlign === 'left') labelX = chartLeft + 4;
        if (textAlign === 'right') labelX = chartRight - 4;

        const labelY = chart.chartArea.top - 12;
        ctx.fillText(labelText, labelX, labelY);
      }
    }
  };

  // ‚úÖ Load CSV and render chart
  async function fetchCSVData() {
    const response = await fetch('Data/USA_MarketCap_LargestShare.csv');
    const text = await response.text();
    const rows = text.trim().split('\n').slice(1); // Skip header

    const data = rows.map(row => {
      const [label, value, company] = row.split(',');
      return {
        x: new Date(label),
        y: parseFloat(value),
        z: company
      };
    });

    renderChart(data);
  }

  // ‚úÖ Render Chart.js line chart
  let chartInstance = null;

function renderChart(data) {
  const ctx = document.getElementById('myChart').getContext('2d');

  if (chartInstance) {
    chartInstance.destroy(); // ‚úÖ Clean up previous chart
  }

  const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
  const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.3)' : 'rgba(0, 0, 0, 0.05)';
  const tickColor = isDarkMode ? '#eee' : '#333';

  const gradient = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
  gradient.addColorStop(0, 'rgba(58, 110, 165, 0.7)');
  gradient.addColorStop(1, 'rgba(58, 110, 165, 0.1)');

  chartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      datasets: [{
        label: 'Public Companies',
        data: data,
        borderColor: '#3a6ea5',
        backgroundColor: gradient,
        fill: true,
        tension: 0.4,
        pointRadius: 0,
        pointHoverRadius: 0
      }]
    },
    options: {
      responsive: true,
      interaction: {
        mode: 'index',
        intersect: false
      },
      layout: {
        padding: {
          top: 50,
          right: 8
        }
      },
      plugins: {
        tooltip: {
          enabled: false
        },
        legend: {
          display: false
        }
      },
      scales: {
        x: {
          type: 'time',
          min: '1970-01-01',
          bounds: 'ticks',
  
          time: {
            unit: 'year',
            displayFormats: {
              month: 'yyyy'
            }
          },
          ticks: {
            font: {
              size: 14,
              family: 'Segoe UI, system-ui, -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif'
            },
            color: tickColor,
            minTicksLimit: 3,   // ‚úÖ Minimum number of ticks
            maxTicksLimit: 6,   // ‚úÖ Maximum number of ticks
          },
          grid: {
            display: false,
            color: gridColor
          }
        },
        y: {
          beginAtZero: false,
          ticks: {
            font: {
              size: 14,
              family: 'Segoe UI, system-ui, -apple-system, BlinkMacSystemFont, Roboto, Helvetica, Arial, sans-serif'
            },
            color: tickColor,
            minTicksLimit: 3,
            maxTicksLimit: 5   // ‚úÖ Maximum number of ticks
          },
          grid: {
            display: true,
            drawOnChartArea: true,
            color: gridColor
          }
        }
      }
    },
    plugins: [verticalLinePlugin]
  });
}
  // ‚úÖ Kick off the chart rendering
  fetchCSVData();
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
  fetchCSVData(); // ‚úÖ Re-fetch and re-render chart on theme change
});
</script>

<script>
  document.getElementById('downloadCSV').addEventListener('click', async () => {
    try {
      const response = await fetch('Data/USA_MarketCap_LargestShare.csv');
      if (!response.ok) throw new Error('File not found');
      const csv = await response.text();

      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);

      const link = document.createElement('a');
      link.href = url;
      link.download = 'USA_MarketCap_LargestShare.csv';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    } catch (err) {
      console.error('Download failed:', err);
      alert('Sorry, the CSV file could not be downloaded.');
    }
  });
</script>

</html>
